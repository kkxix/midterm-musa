<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="AKH Consultants - Annalise Abraham, Katie Knox, and Hope Levin">

<title>Philadelphia Housing Model - Technical Appendix</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TechnicalAppendix_files/libs/clipboard/clipboard.min.js"></script>
<script src="TechnicalAppendix_files/libs/quarto-html/quarto.js"></script>
<script src="TechnicalAppendix_files/libs/quarto-html/popper.min.js"></script>
<script src="TechnicalAppendix_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TechnicalAppendix_files/libs/quarto-html/anchor.min.js"></script>
<link href="TechnicalAppendix_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TechnicalAppendix_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TechnicalAppendix_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TechnicalAppendix_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TechnicalAppendix_files/libs/bootstrap/bootstrap-10daa034703793678e481cc8cee6d76f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="TechnicalAppendix_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="TechnicalAppendix_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#phase-1-data-preparation" id="toc-phase-1-data-preparation" class="nav-link active" data-scroll-target="#phase-1-data-preparation">PHASE 1: DATA PREPARATION</a>
  <ul class="collapse">
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load Packages</a></li>
  <li><a href="#clean-property-data" id="toc-clean-property-data" class="nav-link" data-scroll-target="#clean-property-data">Clean Property Data</a></li>
  <li><a href="#load-census-data" id="toc-load-census-data" class="nav-link" data-scroll-target="#load-census-data">Load Census Data</a></li>
  <li><a href="#data-cleaning-summary" id="toc-data-cleaning-summary" class="nav-link" data-scroll-target="#data-cleaning-summary">Data Cleaning Summary:</a></li>
  <li><a href="#data-cleaning-narrative" id="toc-data-cleaning-narrative" class="nav-link" data-scroll-target="#data-cleaning-narrative"><strong>Data Cleaning Narrative:</strong></a></li>
  <li><a href="#load-spatial-amenities-data" id="toc-load-spatial-amenities-data" class="nav-link" data-scroll-target="#load-spatial-amenities-data">Load Spatial Amenities Data</a></li>
  <li><a href="#transform-data-to-sf-objects-and-match-all-crs" id="toc-transform-data-to-sf-objects-and-match-all-crs" class="nav-link" data-scroll-target="#transform-data-to-sf-objects-and-match-all-crs">Transform data to sf objects, and match all CRS</a></li>
  <li><a href="#join-census-data-to-property-sales-data" id="toc-join-census-data-to-property-sales-data" class="nav-link" data-scroll-target="#join-census-data-to-property-sales-data">Join census data to property sales data</a></li>
  <li><a href="#join-spatial-amenities-data" id="toc-join-spatial-amenities-data" class="nav-link" data-scroll-target="#join-spatial-amenities-data">Join Spatial Amenities Data</a></li>
  </ul></li>
  <li><a href="#phase-2-exploratory-data-analysis---data-visualizations" id="toc-phase-2-exploratory-data-analysis---data-visualizations" class="nav-link" data-scroll-target="#phase-2-exploratory-data-analysis---data-visualizations">PHASE 2: EXPLORATORY DATA ANALYSIS - DATA VISUALIZATIONS</a>
  <ul class="collapse">
  <li><a href="#geographic-distribution-map" id="toc-geographic-distribution-map" class="nav-link" data-scroll-target="#geographic-distribution-map"><strong>#1 Geographic Distribution (Map)</strong></a>
  <ul class="collapse">
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation"><strong>Interpretation:</strong></a></li>
  <li><a href="#map-of-sale-prices---log-transformed" id="toc-map-of-sale-prices---log-transformed" class="nav-link" data-scroll-target="#map-of-sale-prices---log-transformed"><strong>Map of Sale Prices - Log Transformed</strong></a></li>
  <li><a href="#interpretation-1" id="toc-interpretation-1" class="nav-link" data-scroll-target="#interpretation-1"><strong>Interpretation:</strong></a></li>
  </ul></li>
  <li><a href="#distribution-of-sale-prices-histogram" id="toc-distribution-of-sale-prices-histogram" class="nav-link" data-scroll-target="#distribution-of-sale-prices-histogram"><strong>#2 Distribution of Sale Prices (Histogram)</strong></a>
  <ul class="collapse">
  <li><a href="#interpretation-2" id="toc-interpretation-2" class="nav-link" data-scroll-target="#interpretation-2"><strong>Interpretation:</strong></a></li>
  <li><a href="#sale-prices-histogram---log-transformed" id="toc-sale-prices-histogram---log-transformed" class="nav-link" data-scroll-target="#sale-prices-histogram---log-transformed"><strong>Sale Prices Histogram - Log Transformed</strong></a></li>
  <li><a href="#interpretation-3" id="toc-interpretation-3" class="nav-link" data-scroll-target="#interpretation-3"><strong>Interpretation:</strong></a></li>
  </ul></li>
  <li><a href="#price-vs.-structural-features---scatter-plot-price-vs.-number-of-bedrooms" id="toc-price-vs.-structural-features---scatter-plot-price-vs.-number-of-bedrooms" class="nav-link" data-scroll-target="#price-vs.-structural-features---scatter-plot-price-vs.-number-of-bedrooms">#<strong>3 Price vs.&nbsp;Structural Features - Scatter Plot</strong> Price vs.&nbsp;Number of Bedrooms</a>
  <ul class="collapse">
  <li><a href="#interpretation-4" id="toc-interpretation-4" class="nav-link" data-scroll-target="#interpretation-4"><strong>Interpretation:</strong></a></li>
  </ul></li>
  <li><a href="#price-vs.-spatial-features---scatter-plot" id="toc-price-vs.-spatial-features---scatter-plot" class="nav-link" data-scroll-target="#price-vs.-spatial-features---scatter-plot">#<strong>4 Price vs.&nbsp;Spatial Features - Scatter Plot</strong></a></li>
  <li><a href="#price-vs.-distance-to-nearest-farmers-market" id="toc-price-vs.-distance-to-nearest-farmers-market" class="nav-link" data-scroll-target="#price-vs.-distance-to-nearest-farmers-market">Price vs.&nbsp;Distance to Nearest Farmer’s Market</a>
  <ul class="collapse">
  <li><a href="#interpretation-5" id="toc-interpretation-5" class="nav-link" data-scroll-target="#interpretation-5"><strong>Interpretation:</strong></a></li>
  </ul></li>
  <li><a href="#creative-visualization-choropleth-map-of-median-prices-and-median-income" id="toc-creative-visualization-choropleth-map-of-median-prices-and-median-income" class="nav-link" data-scroll-target="#creative-visualization-choropleth-map-of-median-prices-and-median-income">#<strong>5 Creative Visualization</strong>: Choropleth Map of Median Prices and Median Income</a>
  <ul class="collapse">
  <li><a href="#interpretation-6" id="toc-interpretation-6" class="nav-link" data-scroll-target="#interpretation-6">Interpretation:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#phase-3-feature-engineering" id="toc-phase-3-feature-engineering" class="nav-link" data-scroll-target="#phase-3-feature-engineering">PHASE 3: FEATURE ENGINEERING</a>
  <ul class="collapse">
  <li><a href="#price-per-bedroom" id="toc-price-per-bedroom" class="nav-link" data-scroll-target="#price-per-bedroom">Price per Bedroom:</a></li>
  <li><a href="#home-costs-relative-to-income" id="toc-home-costs-relative-to-income" class="nav-link" data-scroll-target="#home-costs-relative-to-income">Home Costs Relative to Income:</a></li>
  <li><a href="#affordability-measure" id="toc-affordability-measure" class="nav-link" data-scroll-target="#affordability-measure">Affordability Measure:</a></li>
  <li><a href="#access-index" id="toc-access-index" class="nav-link" data-scroll-target="#access-index">Access Index:</a></li>
  <li><a href="#buffers" id="toc-buffers" class="nav-link" data-scroll-target="#buffers">Buffers:</a></li>
  <li><a href="#summary-of-features" id="toc-summary-of-features" class="nav-link" data-scroll-target="#summary-of-features"><strong>Summary of Features:</strong></a></li>
  </ul></li>
  <li><a href="#phase-4-model-building" id="toc-phase-4-model-building" class="nav-link" data-scroll-target="#phase-4-model-building">PHASE 4: MODEL BUILDING</a>
  <ul class="collapse">
  <li><a href="#further-data-cleaning" id="toc-further-data-cleaning" class="nav-link" data-scroll-target="#further-data-cleaning">Further data cleaning</a></li>
  <li><a href="#creating-feature-sets" id="toc-creating-feature-sets" class="nav-link" data-scroll-target="#creating-feature-sets"><strong>Creating Feature Sets</strong></a></li>
  <li><a href="#building-models" id="toc-building-models" class="nav-link" data-scroll-target="#building-models">Building Models</a></li>
  <li><a href="#stargazer-output" id="toc-stargazer-output" class="nav-link" data-scroll-target="#stargazer-output"><strong>Stargazer Output</strong></a></li>
  </ul></li>
  <li><a href="#phase-5-model-validation" id="toc-phase-5-model-validation" class="nav-link" data-scroll-target="#phase-5-model-validation">PHASE 5: MODEL VALIDATION</a></li>
  <li><a href="#phase-6-model-diagnostics" id="toc-phase-6-model-diagnostics" class="nav-link" data-scroll-target="#phase-6-model-diagnostics">PHASE 6: MODEL DIAGNOSTICS</a></li>
  <li><a href="#phase-7-conclusions-recommendations" id="toc-phase-7-conclusions-recommendations" class="nav-link" data-scroll-target="#phase-7-conclusions-recommendations">PHASE 7: CONCLUSIONS &amp; RECOMMENDATIONS</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Philadelphia Housing Model - Technical Appendix</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>AKH Consultants - Annalise Abraham, Katie Knox, and Hope Levin </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="phase-1-data-preparation" class="level1">
<h1>PHASE 1: DATA PREPARATION</h1>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load Packages</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="clean-property-data" class="level2">
<h2 class="anchored" data-anchor-id="clean-property-data">Clean Property Data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>property_sales <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://github.com/MUSA-5080-Fall-2025/MUSA-5080-Fall-2025/releases/download/v1.0.0/opa_properties_public.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `opa_properties_public' from data source 
  `https://github.com/MUSA-5080-Fall-2025/MUSA-5080-Fall-2025/releases/download/v1.0.0/opa_properties_public.csv' 
  using driver `CSV'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: no simple feature geometries present: returning a data.frame or tbl_df</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>property_sales_res <span class="ot">&lt;-</span> property_sales <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(zoning, <span class="st">"^R"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(zoning, <span class="st">"IRMX"</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(category_code_description, <span class="st">"SINGLE FAMILY"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(category_code_description, <span class="st">"MULTI FAMILY"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(category_code_description, <span class="st">"MIXED USE"</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sale_price_n =</span> <span class="fu">as.numeric</span>(sale_price)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sale_price_n <span class="sc">&lt;</span> <span class="dv">10000000</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sale_date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-01-01"</span>) <span class="sc">&amp;</span> sale_date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>) )</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>property_sales_res <span class="ot">&lt;-</span> property_sales_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sale_price_n<span class="sc">&lt;</span><span class="dv">10000000</span> <span class="sc">&amp;</span> sale_price_n <span class="sc">&gt;</span> <span class="dv">5000</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(property_sales_res, <span class="fu">aes</span>(<span class="at">x =</span> sale_date, <span class="at">y =</span> sale_price_n)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(property_sales_res, <span class="fu">aes</span>(<span class="at">x =</span> number_of_bedrooms, <span class="at">y =</span> sale_price_n)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting blank cells to NA </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(property_sales_res <span class="sc">==</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     objectid               assessment_date 
                            0                             0 
                    basements               beginning_point 
                         4454                           451 
                book_and_page                 building_code 
                            2                            12 
    building_code_description                 category_code 
                           15                             0 
    category_code_description                  census_tract 
                            0                             0 
                  central_air               cross_reference 
                         4993                         27357 
      date_exterior_condition                         depth 
                        27357                           187 
              exempt_building                   exempt_land 
                            0                             0 
           exterior_condition                    fireplaces 
                           11                           944 
                     frontage                          fuel 
                          189                          8761 
                garage_spaces                   garage_type 
                         1088                         10974 
         general_construction               geographic_ward 
                          244                             0 
          homestead_exemption               house_extension 
                            0                         26867 
                 house_number            interior_condition 
                            0                            12 
                     location             mailing_address_1 
                            0                          3528 
            mailing_address_2               mailing_care_of 
                        27357                         27347 
           mailing_city_state                mailing_street 
                           63                           260 
                  mailing_zip                  market_value 
                           88                             0 
            market_value_date           number_of_bathrooms 
                        27357                          1038 
           number_of_bedrooms               number_of_rooms 
                          232                         25771 
               number_stories               off_street_open 
                          135                           326 
               other_building                       owner_1 
                        27330                             0 
                      owner_2                 parcel_number 
                        18840                             0 
                 parcel_shape                 quality_grade 
                           35                          1046 
               recording_date               registry_number 
                            0                           106 
                    sale_date                    sale_price 
                            0                             0 
           separate_utilities                         sewer 
                        25361                         23810 
                    site_type                    state_code 
                        27357                            62 
                  street_code            street_designation 
                            0                             0 
             street_direction                   street_name 
                        17229                             0 
                       suffix              taxable_building 
                        27339                             0 
                 taxable_land                    topography 
                            0                           478 
                   total_area            total_livable_area 
                            6                             9 
                  type_heater                    unfinished 
                         3738                         27357 
                         unit                       utility 
                        25513                         27357 
                    view_type                    year_built 
                          178                             9 
          year_built_estimate                      zip_code 
                         5659                             0 
                       zoning                           pin 
                            0                             0 
            building_code_new building_code_description_new 
                           39                          1676 
                        shape                  sale_price_n 
                            0                             0 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>property_sales_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(property_sales_res, <span class="cf">function</span>(x) { </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">trimws</span>(x) <span class="co"># remove leading/trailing spaces x[x == ""] &lt;- NA </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x) }))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(property_sales_res))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     objectid               assessment_date 
                            0                             0 
                    basements               beginning_point 
                            0                             0 
                book_and_page                 building_code 
                            0                             0 
    building_code_description                 category_code 
                            0                             0 
    category_code_description                  census_tract 
                            0                             0 
                  central_air               cross_reference 
                            0                             0 
      date_exterior_condition                         depth 
                            0                             0 
              exempt_building                   exempt_land 
                            0                             0 
           exterior_condition                    fireplaces 
                            0                             0 
                     frontage                          fuel 
                            0                             0 
                garage_spaces                   garage_type 
                            0                             0 
         general_construction               geographic_ward 
                            0                             0 
          homestead_exemption               house_extension 
                            0                             0 
                 house_number            interior_condition 
                            0                             0 
                     location             mailing_address_1 
                            0                             0 
            mailing_address_2               mailing_care_of 
                            0                             0 
           mailing_city_state                mailing_street 
                            0                             0 
                  mailing_zip                  market_value 
                            0                             0 
            market_value_date           number_of_bathrooms 
                            0                             0 
           number_of_bedrooms               number_of_rooms 
                            0                             0 
               number_stories               off_street_open 
                            0                             0 
               other_building                       owner_1 
                            0                             0 
                      owner_2                 parcel_number 
                            0                             0 
                 parcel_shape                 quality_grade 
                            0                             0 
               recording_date               registry_number 
                            0                             0 
                    sale_date                    sale_price 
                            0                             0 
           separate_utilities                         sewer 
                            0                             0 
                    site_type                    state_code 
                            0                             0 
                  street_code            street_designation 
                            0                             0 
             street_direction                   street_name 
                            0                             0 
                       suffix              taxable_building 
                            0                             0 
                 taxable_land                    topography 
                            0                             0 
                   total_area            total_livable_area 
                            0                             0 
                  type_heater                    unfinished 
                            0                             0 
                         unit                       utility 
                            0                             0 
                    view_type                    year_built 
                            0                             0 
          year_built_estimate                      zip_code 
                            0                             0 
                       zoning                           pin 
                            0                             0 
            building_code_new building_code_description_new 
                            0                             0 
                        shape                  sale_price_n 
                            0                             0 </code></pre>
</div>
</div>
</section>
<section id="load-census-data" class="level2">
<h2 class="anchored" data-anchor-id="load-census-data">Load Census Data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="st">"5a82e243438bea307ae1c04f150d539c4db5fa47"</span>, <span class="at">install =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>To install your API key for use in future sessions, run this function with `install = TRUE`.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>philadelphia <span class="ot">&lt;-</span> <span class="fu">get_acs</span>( <span class="at">geography =</span> <span class="st">"tract"</span>, <span class="at">county =</span> <span class="st">"Philadelphia"</span>, <span class="at">state =</span> <span class="st">"PA"</span>, <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">median_h_income =</span> <span class="st">"B19013_001"</span>, <span class="at">total_population =</span> <span class="st">"B01003_001"</span>), <span class="at">survey =</span> <span class="st">"acs5"</span>, <span class="at">year =</span> <span class="dv">2023</span>, <span class="at">output =</span> <span class="st">"wide"</span>, <span class="at">geometry =</span> <span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2019-2023 5-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
</div>
</section>
<section id="data-cleaning-summary" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-summary">Data Cleaning Summary:</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Summary tables showing before and after data cleaning</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>before_summary <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">Summary =</span> <span class="st">"Raw data"</span>, <span class="at">Rows =</span> <span class="fu">nrow</span>(property_sales), <span class="at">Columns =</span> <span class="fu">ncol</span>(property_sales) )</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>after_summary <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">Summary =</span> <span class="st">"Cleaned data"</span>, <span class="at">Rows =</span> <span class="fu">nrow</span>(property_sales_res), <span class="at">Columns =</span> <span class="fu">ncol</span>(property_sales_res) )</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into one summary table</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(before_summary, after_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  Summary        Rows Columns
  &lt;chr&gt;         &lt;int&gt;   &lt;int&gt;
1 Raw data     583776      79
2 Cleaned data  27357      80</code></pre>
</div>
</div>
</section>
<section id="data-cleaning-narrative" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-narrative"><strong>Data Cleaning Narrative:</strong></h2>
<p>The dataset initially had 583,776 properties. First we filtered properties based on their zoning code, only keeping those which were residential or ‘IRMX,’ meaning Industrial Residential Mixed Use. #Then to further ensure that we had only residential entries, we filtered for entries that had a category code of single family, multi family, or mixed use. To remove any egregious outliers we removed properties whose sale price was less than $5000 or greater than $10000000. Finally, we only kept sales that occurred in 2023 or 2024. Blank cells were recoded as ’NA.’The cleaned dataset had 27357 lines.</p>
</section>
<section id="load-spatial-amenities-data" class="level2">
<h2 class="anchored" data-anchor-id="load-spatial-amenities-data">Load Spatial Amenities Data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>park_properties <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://hub.arcgis.com/api/v3/datasets/d52445160ab14380a673e5849203eb64_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `PPR_Properties' from data source 
  `https://hub.arcgis.com/api/v3/datasets/d52445160ab14380a673e5849203eb64_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1' 
  using driver `GeoJSON'
Simple feature collection with 504 features and 25 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -75.28353 ymin: 39.87117 xmax: -74.95865 ymax: 40.13186
Geodetic CRS:  WGS 84</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>hospitals <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://opendata.arcgis.com/datasets/df8dc18412494e5abbb021e2f33057b2_0.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `8325e3d0-cbe5-4899-a21f-aa0870da62172020329-1-y8qn03.5pgx' from data source `https://opendata.arcgis.com/datasets/df8dc18412494e5abbb021e2f33057b2_0.geojson' 
  using driver `GeoJSON'
Simple feature collection with 36 features and 8 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.23027 ymin: 39.92185 xmax: -74.98149 ymax: 40.07901
Geodetic CRS:  WGS 84</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>farmers_markets <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://hub.arcgis.com/api/v3/datasets/0707c1f31e2446e881d680b0a5ee54bc_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Farmers_Markets' from data source 
  `https://hub.arcgis.com/api/v3/datasets/0707c1f31e2446e881d680b0a5ee54bc_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1' 
  using driver `GeoJSON'
Simple feature collection with 28 features and 53 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.22686 ymin: 39.92713 xmax: -75.07622 ymax: 40.07898
Geodetic CRS:  WGS 84</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://hub.arcgis.com/api/v3/datasets/d46a7e59e2c246c891fbee778759717e_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Schools' from data source 
  `https://hub.arcgis.com/api/v3/datasets/d46a7e59e2c246c891fbee778759717e_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1' 
  using driver `GeoJSON'
Simple feature collection with 495 features and 14 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.2665 ymin: 39.90781 xmax: -74.97057 ymax: 40.12974
Geodetic CRS:  WGS 84</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>landmarks <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://hub.arcgis.com/api/v3/datasets/68628278b86244469d110232f81ea8f9_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Landmark_Points' from data source 
  `https://hub.arcgis.com/api/v3/datasets/68628278b86244469d110232f81ea8f9_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1' 
  using driver `GeoJSON'
Simple feature collection with 1147 features and 20 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.28169 ymin: 39.85929 xmax: -74.96915 ymax: 40.11991
Geodetic CRS:  WGS 84</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bike_network <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"https://hub.arcgis.com/api/v3/datasets/b5f660b9f0f44ced915995b6d49f6385_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Bike_Network' from data source 
  `https://hub.arcgis.com/api/v3/datasets/b5f660b9f0f44ced915995b6d49f6385_0/downloads/data?format=geojson&amp;spatialRefId=4326&amp;where=1%3D1' 
  using driver `GeoJSON'
Simple feature collection with 5225 features and 8 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -75.26927 ymin: 39.87528 xmax: -74.96572 ymax: 40.124
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="transform-data-to-sf-objects-and-match-all-crs" class="level2">
<h2 class="anchored" data-anchor-id="transform-data-to-sf-objects-and-match-all-crs">Transform data to sf objects, and match all CRS</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(property_sales_res) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System: NA</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>property_sales_res<span class="sc">$</span>geometry <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(property_sales_res<span class="sc">$</span>shape) </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(property_sales_res)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform CRS for Spatial Amenities - to match that of the property sales data</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>park_properties <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(park_properties, <span class="fu">st_crs</span>(res_properties_sf)) </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>hospitals <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(hospitals, <span class="fu">st_crs</span>(res_properties_sf)) </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>farmers_markets <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(farmers_markets, <span class="fu">st_crs</span>(res_properties_sf)) </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(schools, <span class="fu">st_crs</span>(res_properties_sf)) </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>landmarks <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(landmarks, <span class="fu">st_crs</span>(res_properties_sf)) </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>bike_network <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(bike_network, <span class="fu">st_crs</span>(res_properties_sf))</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform census data CRS - to match that of the property sales data</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(philadelphia) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 
  wkt:
GEOGCRS["NAD83",
    DATUM["North American Datum 1983",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4269]]</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>philadelphia <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(philadelphia, <span class="fu">st_crs</span>(res_properties_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-census-data-to-property-sales-data" class="level2">
<h2 class="anchored" data-anchor-id="join-census-data-to-property-sales-data">Join census data to property sales data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>philadelphia <span class="ot">&lt;-</span> philadelphia <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">census_tract =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(NAME, <span class="st">"(?&lt;=Census Tract )</span><span class="sc">\\</span><span class="st">d+(</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+)?"</span>)))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> <span class="fu">st_join</span>(res_properties_sf, philadelphia <span class="sc">%&gt;%</span> <span class="fu">select</span>(median_h_incomeE, total_populationE), <span class="at">left =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="join-spatial-amenities-data" class="level2">
<h2 class="anchored" data-anchor-id="join-spatial-amenities-data">Join Spatial Amenities Data</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1 Join parks data - What is the distance to the nearest park?**</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that some of the parks are super tiny! It also includes playgrounds and rec centers, etc</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix (properties to parks)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>dist_matrix_parks <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(res_properties_sf, park_properties)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get mean distance to k nearest neighbors</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>park_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(dist_matrix_parks, k) {</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(dist_matrix_parks, <span class="dv">1</span>, <span class="cf">function</span>(distances) { </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort distances and take the first k, then average</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">as.numeric</span>(<span class="fu">sort</span>(distances)[<span class="dv">1</span><span class="sc">:</span>k]))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nearest park distance as a column</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_park =</span> <span class="fu">park_distance</span>(dist_matrix_parks, <span class="at">k =</span> <span class="dv">1</span>))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">#2 Join hospitals data - What is the distance to the nearest hospital?</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix (properties to hospitals)</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>dist_matrix_hospitals <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(res_properties_sf, hospitals)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get mean distance to k nearest neighbors</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>hosp_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(dist_matrix_hospitals, k) {</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(dist_matrix_hospitals, <span class="dv">1</span>, <span class="cf">function</span>(distances) {</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort distances, take the nearest k, then calculate the average</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">as.numeric</span>(<span class="fu">sort</span>(distances)[<span class="dv">1</span><span class="sc">:</span>k]))</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nearest hospital distance as a column</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_hospital =</span> <span class="fu">hosp_distance</span>(dist_matrix_hospitals, <span class="at">k =</span> <span class="dv">1</span>))</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="co">#hospital distance in miles </span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_hospital_mi =</span> nearest_hospital<span class="sc">/</span><span class="dv">5280</span> )</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="co">#3 Join farmers market data - what is the distance to the nearest farmers market?</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix (properties to farmers markets)</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>dist_matrix_market <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(res_properties_sf, farmers_markets)</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get nearest distance</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>market_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(dist_matrix_market, k) {</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(dist_matrix_market, <span class="dv">1</span>, <span class="cf">function</span>(distances) {</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort and take first k, then average</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">as.numeric</span>(<span class="fu">sort</span>(distances)[<span class="dv">1</span><span class="sc">:</span>k]))</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nearest farmer's market distance as a column</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nearest_fmarket =</span> <span class="fu">market_distance</span>(dist_matrix_market, <span class="at">k =</span> <span class="dv">1</span>))</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a><span class="co"># market distance in miles</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nearest_fmarket_mi =</span> nearest_fmarket<span class="sc">/</span><span class="dv">5280</span>)</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="co">#4 Join landmark data - what is the distance to the nearest landmark?</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix (properties to landmarks)</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>dist_matrix_landmark <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(res_properties_sf, landmarks)</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get nearest distance</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>landmark_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(dist_matrix_landmark, k) {</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(dist_matrix_landmark, <span class="dv">1</span>, <span class="cf">function</span>(distances) {</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort distances, take the nearest k, then calculate their mean</span></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">as.numeric</span>(<span class="fu">sort</span>(distances)[<span class="dv">1</span><span class="sc">:</span>k]))</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nearest landmark distance as a column</span></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_landmark =</span> <span class="fu">landmark_distance</span>(dist_matrix_landmark, <span class="at">k =</span> <span class="dv">1</span>))</span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a><span class="co"># landmark distance in miles</span></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_landmark_mi =</span> nearest_landmark<span class="sc">/</span><span class="dv">5280</span> )</span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a><span class="co">#5 Join school data - what is the distance to the nearest school?</span></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix (properties to schools)</span></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>dist_matrix_school <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(res_properties_sf, schools)</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get nearest distance</span></span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>school_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(dist_matrix_school, k) {</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(dist_matrix_school, <span class="dv">1</span>, <span class="cf">function</span>(distances) {</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort and take first k, then average</span></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">as.numeric</span>(<span class="fu">sort</span>(distances)[<span class="dv">1</span><span class="sc">:</span>k]))</span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nearest farmer's market distance as a column</span></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_school =</span> <span class="fu">school_distance</span>(dist_matrix_school, <span class="at">k =</span> <span class="dv">1</span>))</span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a><span class="co"># market distance in miles</span></span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_school_mi =</span> nearest_school<span class="sc">/</span><span class="dv">5280</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="phase-2-exploratory-data-analysis---data-visualizations" class="level1">
<h1>PHASE 2: EXPLORATORY DATA ANALYSIS - DATA VISUALIZATIONS</h1>
<section id="geographic-distribution-map" class="level2">
<h2 class="anchored" data-anchor-id="geographic-distribution-map"><strong>#1 Geographic Distribution (Map)</strong></h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sale_price_n =</span> <span class="fu">as.numeric</span>(sale_price_n))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Map of Sale Prices</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res_properties_sf) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> sale_price_n), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>, <span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Distribution of Sale Prices in Philadelphia"</span>, <span class="at">color =</span> <span class="st">"Home Price"</span> ) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation"><strong>Interpretation:</strong></h3>
<p>This map visualizes residential property sales across Philadelphia during 2023–2024, with each point representing a single sale and color indicating the sale price. The full range of values is very hard to see on this map because while there is a large range of values, going beyond $8 million, most of them fall on the much lower end of the spectrum. This causes the map to appear mostly one uniform shade of navy blue. A number of higher valued properties (shown in light blue and representing homes just under $2 million) can be seen clustered in northwest Philadelphia and around center city.</p>
</section>
<section id="map-of-sale-prices---log-transformed" class="level3">
<h3 class="anchored" data-anchor-id="map-of-sale-prices---log-transformed"><strong>Map of Sale Prices - Log Transformed</strong></h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> philadelphia, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> res_properties_sf, <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">log10</span>(sale_price_n)), <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>( <span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">dollar</span>(<span class="dv">10</span><span class="sc">^</span>x), <span class="at">name =</span> <span class="st">"Sale Price (log scale)"</span> ) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Residential Property Sale Prices in Philadelphia"</span>, <span class="at">subtitle =</span> <span class="st">"Log-scaled price visualization"</span>, <span class="at">caption =</span> <span class="st">"Data: Property Sales from 2023, 2024"</span> ) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-1" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-1"><strong>Interpretation:</strong></h3>
<p>This map visualizes residential property sales across Philadelphia during 2023–2024, with each point representing a single sale and color indicating the sale price on a logarithmic scale. Using a log scale allows for clearer visualization of the wide range of property values, compressing extremely high prices while preserving overall spatial variation. The pattern reveals clear geographic differences in housing markets: higher sale prices (yellow to orange) are concentrated in central and northwestern neighborhoods—such as Center City, University City, and Chestnut Hill—while lower prices (purple) are more common in much of North and Southwest Philadelphia. These spatial patterns highlight the city’s pronounced housing value disparities, reflecting broader socioeconomic divides. They also show potential gentrification pressures in the areas where low- and mid-priced neighborhoods intersect.</p>
</section>
</section>
<section id="distribution-of-sale-prices-histogram" class="level2">
<h2 class="anchored" data-anchor-id="distribution-of-sale-prices-histogram"><strong>#2 Distribution of Sale Prices (Histogram)</strong></h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res_properties_sf, <span class="fu">aes</span>(<span class="at">x =</span> sale_price_n)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Distribution of Residential Sale Prices in Philadelphia"</span>, <span class="at">subtitle =</span> <span class="st">"Data from 2023, 2024"</span>, <span class="at">x =</span> <span class="st">"Sale Price (USD)"</span>, <span class="at">y =</span> <span class="st">"Number of Properties"</span> ) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-2" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-2"><strong>Interpretation:</strong></h3>
<p>This histogram illustrates the distribution of residential property sale prices in Philadelphia for the years 2023–2024. The data are highly right-skewed, meaning most properties sold at relatively low prices, while a small number of transactions occurred at very high prices. The vast majority of sales cluster below about $500,000, with a sharp peak near the lower end of the price range. Only a few properties sold for prices above $1 million, indicating that such high-value transactions are rare.</p>
</section>
<section id="sale-prices-histogram---log-transformed" class="level3">
<h3 class="anchored" data-anchor-id="sale-prices-histogram---log-transformed"><strong>Sale Prices Histogram - Log Transformed</strong></h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res_properties_sf, <span class="fu">aes</span>(<span class="at">x =</span> sale_price_n)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">fill =</span> <span class="st">"darkorange"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Residential Sale Prices in Philadelphia (Log Scale)"</span>, <span class="at">subtitle =</span> <span class="st">"Data from 2023, 2024"</span>, <span class="at">x =</span> <span class="st">"Sale Price (log10 USD)"</span>, <span class="at">y =</span> <span class="st">"Number of Properties"</span> ) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-3" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-3"><strong>Interpretation:</strong></h3>
<p>This histogram displays the distribution of residential sale prices in Philadelphia (2023–2024) on a logarithmic scale, which makes the skewed price data easier to interpret. The distribution appears roughly bell-shaped, indicating that the underlying price data follow a log-normal distribution. Most residential properties sold for between $100,000 and $1,000,000, forming the central peak of the distribution. Fewer homes sold at very low or very high prices, shown by the tapering tails on both sides.</p>
</section>
</section>
<section id="price-vs.-structural-features---scatter-plot-price-vs.-number-of-bedrooms" class="level2">
<h2 class="anchored" data-anchor-id="price-vs.-structural-features---scatter-plot-price-vs.-number-of-bedrooms">#<strong>3 Price vs.&nbsp;Structural Features - Scatter Plot</strong> Price vs.&nbsp;Number of Bedrooms</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span>             <span class="fu">mutate</span>(<span class="at">number_of_bedrooms =</span> <span class="fu">as.numeric</span>(number_of_bedrooms))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data =</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(number_of_bedrooms)), <span class="fu">aes</span>(<span class="at">x =</span> number_of_bedrooms, <span class="at">y =</span> sale_price_n) ) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"darkorange"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Residential Sale Prices by Number of Bedrooms"</span>, <span class="at">subtitle =</span> <span class="st">"Data from 2023, 2024 Philadelphia"</span>, <span class="at">x =</span> <span class="st">"Number of Bedrooms"</span>, <span class="at">y =</span> <span class="st">"Sale Price (USD)"</span> ) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-4" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-4"><strong>Interpretation:</strong></h3>
<p>The scatter plot shows the relationship between the number of bedrooms in residential properties and their sale prices in Philadelphia for 2023 and 2024. The trend line does indicate a general upward trajectory, suggesting that sale prices tend to increase as the number of bedrooms increases. At the same time, the data shows a wide range of sale prices within each bedroom category, indicating that other factors such as neighborhood location, property condition, amenities, and lot size also have a large influence on overall value. In each bedroom category, most of the properties are valued below $2,000,000. There are also many high outliers in each category, meaning that for luxury properties the number of bedrooms is not highly associated with the value. Also, beyond 6 bedrooms, the sale prices begin to taper off, suggesting that at that point additional bedrooms have a diminishing return.</p>
</section>
</section>
<section id="price-vs.-spatial-features---scatter-plot" class="level2">
<h2 class="anchored" data-anchor-id="price-vs.-spatial-features---scatter-plot">#<strong>4 Price vs.&nbsp;Spatial Features - Scatter Plot</strong></h2>
</section>
<section id="price-vs.-distance-to-nearest-farmers-market" class="level2">
<h2 class="anchored" data-anchor-id="price-vs.-distance-to-nearest-farmers-market">Price vs.&nbsp;Distance to Nearest Farmer’s Market</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data =</span> res_properties_sf, <span class="fu">aes</span>(<span class="at">x =</span> nearest_fmarket_mi, <span class="at">y =</span> sale_price_n) ) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Residential Sale Prices by Nearest Market"</span>, <span class="at">subtitle =</span> <span class="st">"Data from 2023, 2024 Philadelphia"</span>, <span class="at">x =</span> <span class="st">"Distance to Nearest Farmer's Market, Miles"</span>, <span class="at">y =</span> <span class="st">"Sale Price (USD)"</span> ) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-5" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-5"><strong>Interpretation:</strong></h3>
<p>The scatter plot shows the relationship between the distance to the nearest farmers’ market and the sale price. The highest valued properties are clustered within 1 mile from a market. Beyond 2 miles, the values fall sharply. This suggests that proximity to farmers markets does to some degree play a role in sale value. However, it is almost important to note that there is a very wide range or properties within 1 mile. Overall this graphic is most revealing about the proximity of high end properties to farmers markets.</p>
</section>
</section>
<section id="creative-visualization-choropleth-map-of-median-prices-and-median-income" class="level2">
<h2 class="anchored" data-anchor-id="creative-visualization-choropleth-map-of-median-prices-and-median-income">#<strong>5 Creative Visualization</strong>: Choropleth Map of Median Prices and Median Income</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tract_level_data <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>            <span class="co"># remove geometry for calculation</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(census_tract) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_price =</span> <span class="fu">median</span>(sale_price_n, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_income =</span> <span class="fu">median</span>(median_h_incomeE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># ensure tract-level summary</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>tract_level_data <span class="ot">&lt;-</span> tract_level_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">census_tract =</span> <span class="fu">as.numeric</span>(census_tract))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>tracts_merged <span class="ot">&lt;-</span> philadelphia <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(tract_level_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"census_tract"</span>))</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>tracts_merged <span class="ot">&lt;-</span> tracts_merged <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">income_cat =</span> <span class="fu">cut</span>(median_income, <span class="at">breaks =</span> <span class="fu">quantile</span>(median_income, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.33</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low Income"</span>, <span class="st">"Medium Income"</span>, <span class="st">"High Income"</span>)), <span class="at">price_cat =</span> <span class="fu">cut</span>(median_price, <span class="at">breaks =</span> <span class="fu">quantile</span>(median_price, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.33</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low Price"</span>, <span class="st">"Medium Price"</span>, <span class="st">"High Price"</span>)), <span class="at">bivariate_cat =</span> <span class="fu">interaction</span>(income_cat, price_cat, <span class="at">sep =</span> <span class="st">"-"</span>) )</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define bivariate color palette</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>bivariate_colors <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"Low Income-Low Price"</span> <span class="ot">=</span> <span class="st">"#e8e8e8"</span>, <span class="st">"Medium Income-Low Price"</span> <span class="ot">=</span> <span class="st">"#ace4e4"</span>, <span class="st">"High Income-Low Price"</span> <span class="ot">=</span> <span class="st">"#5ac8c8"</span>, <span class="st">"Low Income-Medium Price"</span> <span class="ot">=</span> <span class="st">"#dfb0d6"</span>, <span class="st">"Medium Income-Medium Price"</span> <span class="ot">=</span> <span class="st">"#a5add3"</span>, <span class="st">"High Income-Medium Price"</span> <span class="ot">=</span> <span class="st">"#5698b9"</span>, <span class="st">"Low Income-High Price"</span> <span class="ot">=</span> <span class="st">"#be64ac"</span>, <span class="st">"Medium Income-High Price"</span> <span class="ot">=</span> <span class="st">"#8c62aa"</span>, <span class="st">"High Income-High Price"</span> <span class="ot">=</span> <span class="st">"#3b4994"</span> )</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tracts_merged) <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> bivariate_cat), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors, <span class="at">name =</span> <span class="st">"Income vs Price"</span>, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Bivariate Choropleth Map of Property Values and Median Income"</span>, <span class="at">subtitle =</span> <span class="st">"Census Tracts in Philadelphia (2023–2024)"</span>, ) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>( <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="at">legend.position =</span> <span class="st">"right"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-6" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-6">Interpretation:</h3>
<p>This is a bivariate choropleth map of median home values and median income by census tract in Philadelphia. Median home values and median income were broken into tertiles. This shows that high-income, high-price areas are highly clustered in northwest Philadelphia, but also close to center city, university city, and in parts of the northeast. Low-income, low-price areas are found in the west and southwest, the north, and the northeast. These would indicate underfunded areas. The low-income, high price areas could represent areas that are quickly gentrifying. Low income residents here are at risked of getting pushed out of these neighborhoods.</p>
</section>
</section>
</section>
<section id="phase-3-feature-engineering" class="level1">
<h1>PHASE 3: FEATURE ENGINEERING</h1>
<section id="price-per-bedroom" class="level2">
<h2 class="anchored" data-anchor-id="price-per-bedroom">Price per Bedroom:</h2>
<p>This measures to what extent a property becomes more valuable based on the number of bedrooms it has.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sale_price_n =</span> <span class="fu">as.numeric</span>(sale_price_n),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">number_of_bedrooms =</span> <span class="fu">as.numeric</span>(number_of_bedrooms)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">price_per_bedroom =</span> sale_price_n<span class="sc">/</span>number_of_bedrooms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="home-costs-relative-to-income" class="level2">
<h2 class="anchored" data-anchor-id="home-costs-relative-to-income">Home Costs Relative to Income:</h2>
<p>This feature divides the sale price by the median household income of the census tract it is in. A lower ratio would indicate more affordable housing in the given tract, while a higher ratio would indicate more expensive housing.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">price_to_income =</span> sale_price_n <span class="sc">/</span> median_h_incomeE )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="affordability-measure" class="level2">
<h2 class="anchored" data-anchor-id="affordability-measure">Affordability Measure:</h2>
<p>This feature divides the tract’s median household income by the sale price. A lower score would indicate the housing is more affordable, while a higher score would mean the property is less affordable.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">affordability =</span> median_h_incomeE <span class="sc">/</span> sale_price_n )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="access-index" class="level2">
<h2 class="anchored" data-anchor-id="access-index">Access Index:</h2>
<p>This feature creates one general score to indicate access to multiple valuable amenities including parks, hospitals, farmers markets, landmarks, and schools.A higher score indicates better access.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">nearest_park_mi =</span> nearest_park <span class="sc">/</span> <span class="dv">5280</span> )</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">access_index =</span> ( <span class="dv">1</span> <span class="sc">/</span> nearest_park_mi) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> nearest_hospital_mi) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> nearest_fmarket_mi) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>nearest_landmark_mi) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>nearest_school_mi) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="buffers" class="level2">
<h2 class="anchored" data-anchor-id="buffers">Buffers:</h2>
<p>These features use buffers to determine the number of amenities within a half mile buffer of each property. The amenities considered are again parks, schools, farmers markets, hospitals, and landmarks.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>property_buffers <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>( res_properties_sf, <span class="at">dist =</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">5280</span> )</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">n_parks_near =</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(property_buffers, park_properties)), <span class="at">n_schools_near =</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(property_buffers, schools)), <span class="at">n_fmarkets_near =</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(property_buffers, farmers_markets)), <span class="at">n_hospitals_near =</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(property_buffers, hospitals)), <span class="at">n_landmarks_near =</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(property_buffers, landmarks)) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-features" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-features"><strong>Summary of Features:</strong></h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(price_per_bedroom, price_to_income, affordability, nearest_park_mi,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>         nearest_hospital_mi, nearest_fmarket_mi, nearest_landmark_mi,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>         nearest_school_mi, access_index, n_parks_near, n_schools_near,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>         n_fmarkets_near, n_hospitals_near, n_landmarks_near) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `dplyr::summarize()`.
ℹ In argument: `dplyr::across(tidyselect::any_of(variable_names),
  mangled_skimmers$funs)`.
ℹ In group 0: .
Caused by warning:
! There was 1 warning in `dplyr::summarize()`.
ℹ In argument: `dplyr::across(tidyselect::any_of(variable_names),
  mangled_skimmers$funs)`.
Caused by warning in `inline_hist()`:
! Variable contains Inf or -Inf value(s) that were converted to NA.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Piped data</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">27357</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">price_per_bedroom</td>
<td style="text-align: right;">232</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">1428.57</td>
<td style="text-align: right;">53333.33</td>
<td style="text-align: right;">86666.67</td>
<td style="text-align: right;">140000.00</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">price_to_income</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: right;">11.30</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">2.71</td>
<td style="text-align: right;">3.88</td>
<td style="text-align: right;">5.44</td>
<td style="text-align: right;">283.08</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">affordability</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">11.07</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">nearest_park_mi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nearest_hospital_mi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">1.27</td>
<td style="text-align: right;">4.90</td>
<td style="text-align: left;">▇▅▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">nearest_fmarket_mi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.35</td>
<td style="text-align: right;">1.36</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">7.48</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nearest_landmark_mi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: left;">▇▆▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">nearest_school_mi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: left;">▇▅▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">access_index</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">29.04</td>
<td style="text-align: right;">24.82</td>
<td style="text-align: right;">3.81</td>
<td style="text-align: right;">16.48</td>
<td style="text-align: right;">22.79</td>
<td style="text-align: right;">33.08</td>
<td style="text-align: right;">781.52</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">n_parks_near</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5.43</td>
<td style="text-align: right;">3.96</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">27.00</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">n_schools_near</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">4.56</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">17.00</td>
<td style="text-align: left;">▇▆▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">n_fmarkets_near</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">n_hospitals_near</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">n_landmarks_near</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5.93</td>
<td style="text-align: right;">10.43</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">80.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="phase-4-model-building" class="level1">
<h1>PHASE 4: MODEL BUILDING</h1>
<section id="further-data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="further-data-cleaning">Further data cleaning</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert variables to numeric for later</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_livable_area =</span> <span class="fu">as.numeric</span>(total_livable_area), </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number_of_bathrooms =</span> <span class="fu">as.numeric</span>(number_of_bathrooms), </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">frontage =</span> <span class="fu">as.numeric</span>(frontage),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fireplaces =</span> <span class="fu">as.numeric</span>(fireplaces), </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_built =</span> <span class="fu">as.numeric</span>(year_built) )</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#create categorical variables</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>quality_grade <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(res_properties_sf<span class="sc">$</span>quality_grade)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>category_code <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(res_properties_sf<span class="sc">$</span>category_code)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># log to reduce skew - compresses large values to make more symmetrical</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">log_price =</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(sale_price_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="creating-feature-sets" class="level2">
<h2 class="anchored" data-anchor-id="creating-feature-sets"><strong>Creating Feature Sets</strong></h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Structural features</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>structural_features <span class="ot">&lt;-</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(log_price, number_of_bedrooms,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms,total_livable_area)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># census variables features</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>census_features <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(log_price,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>number_of_bedrooms, number_of_bathrooms,total_livable_area,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>median_h_incomeE, total_populationE)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># spatial features</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>spatial_features <span class="ot">&lt;-</span> res_properties_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(log_price,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>number_of_bedrooms, number_of_bathrooms,total_livable_area,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>median_h_incomeE, total_populationE, nearest_park_mi,</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>nearest_hospital_mi, nearest_fmarket_mi, nearest_landmark_mi,</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>nearest_school_mi, n_parks_near, n_schools_near, n_fmarkets_near,</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>n_hospitals_near, n_landmarks_near, access_index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="building-models" class="level2">
<h2 class="anchored" data-anchor-id="building-models">Building Models</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># structural model </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>structural_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price <span class="sc">~</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>number_of_bedrooms <span class="sc">+</span> number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>fireplaces, <span class="at">data =</span> res_properties_sf)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># census model</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>census_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">+</span> fireplaces <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>median_h_incomeE <span class="sc">+</span> total_populationE <span class="sc">+</span>price_to_income, <span class="at">data =</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>res_properties_sf)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co"># spatial model</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>spatial_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">+</span> fireplaces <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>median_h_incomeE <span class="sc">+</span> total_populationE <span class="sc">+</span> price_to_income<span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>nearest_park_mi <span class="sc">+</span> nearest_hospital_mi <span class="sc">+</span> nearest_fmarket_mi <span class="sc">+</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>nearest_landmark_mi <span class="sc">+</span> nearest_school_mi <span class="sc">+</span> n_parks_near <span class="sc">+</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>n_schools_near <span class="sc">+</span> n_fmarkets_near <span class="sc">+</span> n_hospitals_near <span class="sc">+</span> n_landmarks_near <span class="sc">+</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>access_index, <span class="at">data =</span> res_properties_sf)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed effects interaction model</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>fixed_effects_interation_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">*</span> median_h_incomeE <span class="sc">+</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>year_built<span class="sc">*</span>median_h_incomeE <span class="sc">+</span> fireplaces <span class="sc">+</span> total_populationE <span class="sc">+</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>price_to_income<span class="sc">+</span> nearest_park_mi <span class="sc">+</span> nearest_hospital_mi <span class="sc">+</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>nearest_fmarket_mi <span class="sc">+</span> nearest_landmark_mi <span class="sc">+</span> nearest_school_mi <span class="sc">+</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>n_parks_near <span class="sc">+</span> n_schools_near <span class="sc">+</span> n_fmarkets_near <span class="sc">+</span> n_hospitals_near <span class="sc">+</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>n_landmarks_near <span class="sc">+</span> access_index <span class="sc">+</span> category_code, <span class="at">data =</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>res_properties_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We built our each model with progressively more features in the following categories along with our hypotheses about their interaction with the dependent variable:</p>
<ol type="1">
<li><p><strong>Structural features</strong>: These features came from the property sales data, and thus each sale has a unique value for the following variables:</p>
<ul>
<li><em>Number of bedrooms and bathrooms</em>: Higher numbers tends to increase price</li>
<li><em>Total livable area</em>: More livable area tends to increase price</li>
<li><em>Fireplaces</em>: More fireplaces tends to be associated with luxury and thus price</li>
</ul></li>
<li><p><strong>Census features</strong>: These features come from the ACS and are aggregated at the tract level, so each sale may share values with other sales:</p>
<ul>
<li><em>Median Household Income</em>: Higher income areas more likely to afford higher priced properties</li>
<li><em>Total Population</em>: Higher density areas could have more market competition and thus lower prices</li>
<li><em>Price to Income</em>: Computed ratio of sale price to median income, approximating housing affordability</li>
</ul></li>
<li><p><strong>Spatial features</strong>: These features were created by comparing city features to locations of property sales, so each sale has a unique value:</p>
<ul>
<li><em>Nearest Park</em>: A low number and thus a close park may increase property value</li>
<li><em>Nearest Hospital</em>: A low number and thus close hospital may increase property value</li>
<li><em>Nearest Farmer’s Market</em>: Another feature thats nearness may increase value</li>
<li><em>Nearest Landmark</em>: Nearness to landmark could be desirable feature of high value property</li>
<li><em>Nearest School</em>: Nearness to school may increase property value</li>
<li><em>Number of Parks Near</em>: A higher number of parks within .5 mi may increase property value</li>
<li><em>Number of Hospitals Near</em>: Higher number increase property value</li>
<li><em>Number of Landmarks Near</em>: Higher number increase property value</li>
<li><em>Number of Farmer’s Markets Near</em>: Higher number increase property value</li>
<li><em>Number of Schools Near</em>: Higher number increase property value</li>
<li><em>Access Index</em>: This incorporates all above features into one score where a higher number indicates higher access to many types of public features and thus may increase property value</li>
</ul></li>
<li><p><strong>Fixed Effects &amp; Interaction terms</strong>:</p>
<ul>
<li><em>Total Livable Area x Median Household Income</em>: More space in a higher income area could increase property value even more than either variable alone</li>
<li><em>Year Built x Median Household Income</em>: An old home in a higher income area may indicate historically significant, high value property rather than ‘outdated’ and thus lower value</li>
<li><em>Category Code</em>: 1 = Single Family Home, 2 = Multi-Family, 3 = “Mixed Use”. This fixed effect should represent the amount of space per household family member and also account for current cultural preferance for single family homes over shared spaces</li>
</ul></li>
</ol>
</section>
<section id="stargazer-output" class="level2">
<h2 class="anchored" data-anchor-id="stargazer-output"><strong>Stargazer Output</strong></h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stargazer</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    structural_model, census_model, spatial_model, fixed_effects_interation_model,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"text"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">star.cutoffs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Regression Models Comparison"</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression Models Comparison
=========================================================================================================================================================
                                                                                     Dependent variable:                                                 
                                    ---------------------------------------------------------------------------------------------------------------------
                                                                                          log_price                                                      
                                                (1)                          (2)                           (3)                           (4)             
---------------------------------------------------------------------------------------------------------------------------------------------------------
number_of_bedrooms                           -0.119***                    -0.035***                     -0.018***                     -0.019***          
                                              (0.005)                      (0.004)                       (0.004)                       (0.004)           
                                                                                                                                                         
number_of_bathrooms                           0.364***                     0.201***                     0.183***                      0.180***           
                                              (0.007)                      (0.005)                       (0.005)                       (0.006)           
                                                                                                                                                         
total_livable_area                           0.0004***                    0.0002***                     0.0002***                     0.0004***          
                                             (0.00001)                    (0.00001)                     (0.00001)                     (0.00001)          
                                                                                                                                                         
fireplaces                                    0.184***                      0.020                         0.020                       0.063***           
                                              (0.016)                      (0.012)                       (0.011)                       (0.012)           
                                                                                                                                                         
median_h_incomeE                                                          0.00001***                   0.00001***                     0.0001***          
                                                                          (0.00000)                     (0.00000)                     (0.00001)          
                                                                                                                                                         
year_built                                                                                                                            0.004***           
                                                                                                                                      (0.0003)           
                                                                                                                                                         
total_populationE                                                         0.00001***                   0.00001***                    0.00001***          
                                                                          (0.00000)                     (0.00000)                     (0.00000)          
                                                                                                                                                         
price_to_income                                                            0.034***                     0.034***                      0.034***           
                                                                           (0.0003)                     (0.0003)                      (0.0003)           
                                                                                                                                                         
nearest_park_mi                                                                                         0.236***                      0.186***           
                                                                                                         (0.033)                       (0.033)           
                                                                                                                                                         
nearest_hospital_mi                                                                                       0.011                         0.012            
                                                                                                         (0.007)                       (0.007)           
                                                                                                                                                         
nearest_fmarket_mi                                                                                      0.037***                      0.027***           
                                                                                                         (0.003)                       (0.003)           
                                                                                                                                                         
nearest_landmark_mi                                                                                     0.097***                      0.097***           
                                                                                                         (0.025)                       (0.024)           
                                                                                                                                                         
nearest_school_mi                                                                                       0.137***                       0.097**           
                                                                                                         (0.030)                       (0.030)           
                                                                                                                                                         
n_parks_near                                                                                              0.002                         0.002            
                                                                                                         (0.001)                       (0.001)           
                                                                                                                                                         
n_schools_near                                                                                          -0.016***                     -0.013***          
                                                                                                         (0.001)                       (0.001)           
                                                                                                                                                         
n_fmarkets_near                                                                                         0.089***                      0.084***           
                                                                                                         (0.006)                       (0.006)           
                                                                                                                                                         
n_hospitals_near                                                                                        0.093***                      0.087***           
                                                                                                         (0.006)                       (0.006)           
                                                                                                                                                         
n_landmarks_near                                                                                        0.002***                      0.002***           
                                                                                                        (0.0004)                      (0.0004)           
                                                                                                                                                         
access_index                                                                                             0.0001                        0.00003           
                                                                                                        (0.0002)                      (0.0002)           
                                                                                                                                                         
category_code2                                                                                                                        -0.058***          
                                                                                                                                       (0.013)           
                                                                                                                                                         
category_code3                                                                                                                          0.095            
                                                                                                                                       (0.361)           
                                                                                                                                                         
total_livable_area:median_h_incomeE                                                                                                   -0.000***          
                                                                                                                                       (0.000)           
                                                                                                                                                         
median_h_incomeE:year_built                                                                                                          -0.00000***         
                                                                                                                                       (0.000)           
                                                                                                                                                         
Constant                                     11.593***                    10.648***                     10.517***                     2.042***           
                                              (0.015)                      (0.017)                       (0.024)                       (0.502)           
                                                                                                                                                         
---------------------------------------------------------------------------------------------------------------------------------------------------------
Observations                                   25,924                       25,624                       25,624                        25,624            
R2                                             0.241                        0.608                         0.624                         0.631            
Adjusted R2                                    0.241                        0.608                         0.624                         0.631            
Residual Std. Error                      0.735 (df = 25919)           0.526 (df = 25616)           0.516 (df = 25605)            0.511 (df = 25600)      
F Statistic                         2,061.536*** (df = 4; 25919) 5,677.463*** (df = 7; 25616) 2,358.788*** (df = 18; 25605) 1,906.509*** (df = 23; 25600)
=========================================================================================================================================================
Note:                                                                                                                       *p&lt;0.05; **p&lt;0.01; ***p&lt;0.001</code></pre>
</div>
</div>
<p>The Stargazer output sheds some light on the most important variables:</p>
<ul>
<li><strong>Positive Coefficients</strong>: An increase in units of these is associated with an increase in property sale value to a very high degree of confidence (p-value of less than 2e-16):
<ul>
<li>number_of_bathrooms</li>
<li>total_livable_area</li>
<li>median_h_incomeE</li>
<li>year_built</li>
<li>price_to_income</li>
<li>nearest_fmarket_mi (although here a high value is associated with farther distance from a farmer’s market)</li>
<li>n_fmarkets_near (oddly, seeing as farther distance form farmer’s marker is modeled as depressing value, here higher number of close farmer’s markets is positively associated with value)</li>
<li>n_hospitals_near</li>
</ul></li>
<li><strong>Negative Coefficients</strong>: An increase in units of these is associated with a decrease in property sale value to a very high degree of confidence (p-value of less than 2e-16):
<ul>
<li>n_schools_near</li>
<li>category_code2 (multi-family housing as compared to single family housing depressed property sale value)</li>
<li>total_livable_area*median_h_incomeE</li>
<li>median_h_incomeE*year_built</li>
</ul></li>
</ul>
</section>
</section>
<section id="phase-5-model-validation" class="level1">
<h1>PHASE 5: MODEL VALIDATION</h1>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>cv.mod<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">train</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">+</span> fireplaces, <span class="at">data =</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>res_properties_sf, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control, <span class="at">na.action =</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>na.omit)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>cv.mod<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">train</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">+</span> fireplaces <span class="sc">+</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>median_h_incomeE <span class="sc">+</span> total_populationE <span class="sc">+</span>price_to_income, <span class="at">data =</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>res_properties_sf, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control, <span class="at">na.action =</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>na.omit)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>cv.mod<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">train</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">+</span> fireplaces <span class="sc">+</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>median_h_incomeE <span class="sc">+</span> total_populationE <span class="sc">+</span> price_to_income<span class="sc">+</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>nearest_park_mi <span class="sc">+</span> nearest_hospital_mi <span class="sc">+</span> nearest_fmarket_mi <span class="sc">+</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>nearest_landmark_mi <span class="sc">+</span> nearest_school_mi <span class="sc">+</span> n_parks_near <span class="sc">+</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>n_schools_near <span class="sc">+</span> n_fmarkets_near <span class="sc">+</span> n_hospitals_near <span class="sc">+</span> n_landmarks_near <span class="sc">+</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>access_index, <span class="at">data =</span> res_properties_sf, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>train_control, <span class="at">na.action =</span> na.omit)</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>cv.mod<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">train</span>(log_price <span class="sc">~</span> number_of_bedrooms <span class="sc">+</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>number_of_bathrooms <span class="sc">+</span> total_livable_area <span class="sc">*</span> median_h_incomeE <span class="sc">+</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>year_built<span class="sc">*</span>median_h_incomeE <span class="sc">+</span> fireplaces <span class="sc">+</span> total_populationE <span class="sc">+</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>price_to_income<span class="sc">+</span> nearest_park_mi <span class="sc">+</span> nearest_hospital_mi <span class="sc">+</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>nearest_fmarket_mi <span class="sc">+</span> nearest_landmark_mi <span class="sc">+</span> nearest_school_mi <span class="sc">+</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>n_parks_near <span class="sc">+</span> n_schools_near <span class="sc">+</span> n_fmarkets_near <span class="sc">+</span> n_hospitals_near <span class="sc">+</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>n_landmarks_near <span class="sc">+</span> access_index <span class="sc">+</span> category_code, <span class="at">data =</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>res_properties_sf, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control, <span class="at">na.action =</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>na.omit)</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="co">#table of models' stats </span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>metrics_mod1 <span class="ot">&lt;-</span> cv.mod<span class="fl">.1</span><span class="sc">$</span>results[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"Rsquared"</span>, <span class="st">"MAE"</span>)]</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>metrics_mod1<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Structural Model"</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>metrics_mod2 <span class="ot">&lt;-</span> cv.mod<span class="fl">.2</span><span class="sc">$</span>results[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"Rsquared"</span>, <span class="st">"MAE"</span>)]</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>metrics_mod2<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Structural + Census Model"</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>metrics_mod3 <span class="ot">&lt;-</span> cv.mod<span class="fl">.3</span><span class="sc">$</span>results[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"Rsquared"</span>, <span class="st">"MAE"</span>)]</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>metrics_mod3<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Structural + Census + Spatial Model"</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>metrics_mod4 <span class="ot">&lt;-</span> cv.mod<span class="fl">.4</span><span class="sc">$</span>results[<span class="dv">1</span>, <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"Rsquared"</span>, <span class="st">"MAE"</span>)]</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>metrics_mod4<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Structural + Census + Spatial + Fixed Effects &amp;</span></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a><span class="st">Interactions Model"</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>metrics_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metrics_mod1, metrics_mod2, metrics_mod3,</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>metrics_mod4)</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>  metrics_table, </span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"R-Squared"</span>, <span class="st">"MAE"</span>, <span class="st">"Model Name"</span>),</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"How Well do Four Models Explain Variance of Property Sale Data?"</span>,</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"html"</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>How Well do Four Models Explain Variance of Property Sale Data?</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R-Squared</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAE</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.7347832</td>
<td style="text-align: right;">0.2416805</td>
<td style="text-align: right;">0.5240245</td>
<td style="text-align: left;">Structural Model</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.5267767</td>
<td style="text-align: right;">0.6094667</td>
<td style="text-align: right;">0.3712585</td>
<td style="text-align: left;">Structural + Census Model</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.5168419</td>
<td style="text-align: right;">0.6245888</td>
<td style="text-align: right;">0.3603925</td>
<td style="text-align: left;">Structural + Census + Spatial Model</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.5126536</td>
<td style="text-align: right;">0.6293106</td>
<td style="text-align: right;">0.3531167</td>
<td style="text-align: left;">Structural + Census + Spatial + Fixed Effects &amp; Interactions Model</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot fit vs residuals#### </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>resid<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitted =</span> <span class="fu">fitted</span>(cv.mod<span class="fl">.1</span><span class="sc">$</span>finalModel),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">residuals =</span> <span class="fu">resid</span>(cv.mod<span class="fl">.1</span><span class="sc">$</span>finalModel) </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residuals)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residual Plot"</span>, <span class="at">x =</span> <span class="st">"Fitted Values"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>resid<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">fitted =</span> <span class="fu">fitted</span>(cv.mod<span class="fl">.2</span><span class="sc">$</span>finalModel),</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">residuals =</span> <span class="fu">resid</span>(cv.mod<span class="fl">.2</span><span class="sc">$</span>finalModel) )</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid<span class="fl">.2</span>, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residuals)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residual Plot"</span>, <span class="at">x =</span> <span class="st">"Fitted Values"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>resid<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">fitted =</span> <span class="fu">fitted</span>(cv.mod<span class="fl">.3</span><span class="sc">$</span>finalModel),</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">residuals =</span> <span class="fu">resid</span>(cv.mod<span class="fl">.3</span><span class="sc">$</span>finalModel) )</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid<span class="fl">.3</span>, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residuals)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residual Plot"</span>, <span class="at">x =</span> <span class="st">"Fitted Values"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>) <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>resid<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">fitted =</span> <span class="fu">fitted</span>(cv.mod<span class="fl">.4</span><span class="sc">$</span>finalModel),</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">residuals =</span> <span class="fu">resid</span>(cv.mod<span class="fl">.4</span><span class="sc">$</span>finalModel) )</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resid<span class="fl">.4</span>, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residuals)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residual Plot"</span>, <span class="at">x =</span> <span class="st">"Fitted Values"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv.mod<span class="fl">.4</span>, <span class="at">newdata =</span> res_properties_sf)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>fitted <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>fitted[<span class="fu">as.numeric</span>(<span class="fu">names</span>(preds))] <span class="ot">&lt;-</span> preds</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>residuals[<span class="fu">as.numeric</span>(<span class="fu">names</span>(preds))] <span class="ot">&lt;-</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">$</span>log_price[<span class="fu">as.numeric</span>(<span class="fu">names</span>(preds))] <span class="sc">-</span> preds</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>res_properties_sf<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(residuals))<span class="sc">%&gt;%</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> residuals), <span class="at">alpha=</span>.<span class="dv">75</span>)<span class="sc">+</span> </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gradient2</span>( <span class="at">low =</span> <span class="st">"darkred"</span>, <span class="at">mid =</span> <span class="st">"lightgray"</span>, <span class="at">high =</span> <span class="st">"lightgreen"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">"Residual (log-price)"</span>)<span class="sc">+</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Map of Residuals"</span>,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">str_wrap</span>(<span class="st">"Where a positive value indicates an underestimate and a negative value indicates an overestimate"</span>))<span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This Map shows the locations of over and underestimates produced by our model. There is a relatively even spread of high absolute value estimates, but overestimates are visually bunched in North Central Philadelphia, and underestimates are clustered in North East and North West, West, and South Philadelphia. This shows that our model could have benefited from a fixed effect accounting for the sector or neighborhood in estimating price, seeing as the areas underestimated are generally considered the wealthier more desirable areas of Philadelphia, and the overestimated areas are generally considered less desirable areas, where reputation may have more influence over property sale price than amenities, structural features, density, income, and affordability.</p>
</section>
<section id="phase-6-model-diagnostics" class="level1">
<h1>PHASE 6: MODEL DIAGNOSTICS</h1>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.mod<span class="fl">.4</span><span class="sc">$</span>finalModel, <span class="at">which =</span> <span class="dv">1</span>)  <span class="co"># Residuals vs Fitted </span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.mod<span class="fl">.4</span><span class="sc">$</span>finalModel, <span class="at">which =</span> <span class="dv">2</span>)  <span class="co"># Q-Q </span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.mod<span class="fl">.4</span><span class="sc">$</span>finalModel, <span class="at">which =</span> <span class="dv">4</span>)  <span class="co"># Cook's distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TechnicalAppendix_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation</strong>:</p>
<ul>
<li>Residual vs Fitted
<ul>
<li>This plot shows a down-turned curve, indicating heteroscedasticity, or in other words that the lower and higher end of predictions were more often overestimates. The plot indicates our model could further benefit from quadratic terms. There are also potential extreme outliers that could be removed.</li>
</ul></li>
<li>QQPlot
<ul>
<li>This plot indicates the distribution of residuals has very a very long left tail. This indicates that the overestimates are more extreme than a normal distribution would have, again with a cluster of extreme outliers.</li>
</ul></li>
<li>Cook’s distance
<ul>
<li>This plot indeed confirms that there are a handful of extreme outliers that are exerting outsize leverage on the model such as observations X2600 and X12295</li>
</ul></li>
</ul>
<p>In future models, we should not only remove extremely high values (we put a cap at max $10M property sale values) but also we should filter out extremely low property sale values, as they appear to have leverage over the model. We could also investigate if there are terms that should be quadratic given the curved Residual v Fitted plot.</p>
</section>
<section id="phase-7-conclusions-recommendations" class="level1">
<h1>PHASE 7: CONCLUSIONS &amp; RECOMMENDATIONS</h1>
<ol type="1">
<li>What is your final model’s accuracy?</li>
</ol>
<ul>
<li>Our final model explains 62% of the variance in the data.</li>
</ul>
<ol start="2" type="1">
<li>Which features matter most for Philadelphia prices?</li>
</ol>
<ul>
<li>The features that matter the are features such as area, bathrooms, year built, affordability and also interactions between median income, year built, and livable area. The city amenities that matter most for sale price are farmer’s markets, hospitals, and shcools, but less so parks and landmarks. An important fixed effect is the designation of single family home or multi family home, with multi family home exerting a negative effect on sale price compared to single family homes</li>
</ul>
<ol start="3" type="1">
<li>Which neighborhoods are hardest to predict?</li>
</ol>
<ul>
<li>North Central Philadelphia exhibited the highest concentration of overestimated home values, and this could be because the stigma associated with North Central Philadelphia causes other factors that normally increase a home value to have less effect.</li>
</ul>
<ol start="4" type="1">
<li>Equity concerns?</li>
</ol>
<ul>
<li>Given the consistent over-estimation of sale price values in North Central Philadelphia, caution must be exerted in presenting this information. Our map showing income brackets and sale price brackets compared show that North Central has a large concentration of low income and low sale price properties, and thus the inacuracy of predicting the property values in this area could induce overburdening taxes on an already financially burdened area of the city.</li>
</ul>
<ol start="5" type="1">
<li>Limitations?</li>
</ol>
<ul>
<li>Our model’s limitations lie in the outsize influence that a few low sale price properties holds on the model as well as the spatial correlation to under and over estimates. This strongly indicates that accounting for Phidelphia neighborhoods or regions through a fixed effect variable should be considered for further modeling, as this seems like a factor that in many cases matters more than the structural, affordability, or amenity features.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>